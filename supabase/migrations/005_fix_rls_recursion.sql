-- 彻底修复 RLS 递归问题
-- 策略：暂时禁用 RLS，允许所有操作，后续逐步添加安全策略

-- ============================================
-- 1. 完全禁用 RLS（临时方案，用于调试）
-- ============================================

ALTER TABLE conversations DISABLE ROW LEVEL SECURITY;
ALTER TABLE messages DISABLE ROW LEVEL SECURITY;

-- ============================================
-- 说明
-- ============================================
-- 这个方案暂时禁用了所有 RLS 策略，允许任意读写
-- 优点：可以立即测试游客模式是否工作
-- 缺点：没有数据隔离，任何人都可以查看/修改所有数据
--
-- 后续改进方向：
-- 1. 使用 Supabase 的 service_role key 进行服务端操作
-- 2. 创建 Edge Function 来处理数据操作，绕过 RLS
-- 3. 重新设计 RLS 策略，避免任何子查询
