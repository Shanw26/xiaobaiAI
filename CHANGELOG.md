# 更新日志

## [2.9.9] - 2026-01-08

### 🎯 核心优化 - 智能用户信息记录

#### 问题描述
在 v2.9.8 及之前的版本中，当用户提到个人信息时，AI 总是会询问：
> "我发现这是一个关于你的信息，要不要我帮你记下来？"

即使用户明确表示"不需要询问，直接帮用户记下来"，AI 仍然会按照系统提示词的要求，强制询问用户同意。

这导致用户体验不流畅，特别是当用户已经明确表达了直接记录的意图时。

#### 解决方案
优化 `electron/agent.js` 中的系统提示词，从"强制询问"改为"智能判断"：

**修改前**（v2.9.8）：
```javascript
## 用户信息管理
当用户提到以下信息时，**必须先征得用户同意**，然后使用 save_user_info 工具保存：
- 个人信息：姓名、职业、年龄、所在地等
- 偏好信息：喜欢的风格、习惯、需求等
- 背景信息：工作、学习、项目等

**重要**：
1. 先友好地询问："我发现这是一个关于你的信息，要不要我帮你记下来？"
2. 用户同意后，再调用 save_user_info 工具
3. 使用格式：键: 值（例如 "姓名: 晓力"）
```

**修改后**（v2.9.9）：
```javascript
## 用户信息管理
当用户提到以下信息时，需要使用 save_user_info 工具保存：
- 个人信息：姓名、职业、年龄、所在地等
- 偏好信息：喜欢的风格、习惯、需求等
- 背景信息：工作、学习、项目等

**判断逻辑** ⭐ 重要：
1. **直接保存（无需询问）**：当用户明确说以下短语时，直接调用 save_user_info 工具：
   - "不需要询问"、"直接记下来"、"帮我保存"、"帮我记下来"
   - "直接记录"、"保存到记忆"、"记到记忆里"

2. **先询问再保存**：当用户只提到信息，但没有明确指令时，先询问：
   - 询问："我发现这是一个关于你的信息，要不要我帮你记下来？"
   - 用户同意后，再调用 save_user_info 工具

3. 使用格式：键: 值（例如 "姓名: 晓力"）
```

#### 效果对比

| 场景 | 用户输入 | v2.9.8 行为 | v2.9.9 行为 |
|------|---------|-------------|-------------|
| 明确指令 | "你好，我叫笑笑！很高兴认识你！😊 不需要询问，直接帮用户记下来" | ❌ 仍然询问"要不要我帮你记下来？" | ✅ 直接保存，回复"✅ 已记录" |
| 隐式信息 | "我叫晓力，是个产品经理" | ⚠️ 询问"要不要我帮你记下来？" | ✅ 询问"要不要我帮你记下来？"（保持不变） |

#### 技术实现
- **文件位置**: `/Users/xiaolin/Downloads/小白AI/electron/agent.js`
- **修改行数**: 第 813-839 行
- **技术原理**: 通过关键词匹配（"不需要询问"、"直接记下来"等），让 AI 理解用户的明确意图，直接调用 `save_user_info` 工具

---

## [2.9.8] - 2026-01-08

### ✨ 新功能 - AI 记忆云端同步

#### 功能描述
实现 AI 记忆的三层存储架构：
1. **云端数据库**（Supabase）- 主要存储，支持跨设备同步
2. **本地文件**（~/xiaobai-ai-memory.md）- AI Agent 快速读取
3. **本地数据库**（SQLite）- 备份存储

#### 技术实现
- 修改 `electron/agent.js`，优先从云端读取 AI 记忆
- 修改 `electron/main.js`，保存时同时写入云端、本地文件、本地数据库
- 修改 `src/components/SettingsModal.jsx`，设置面板同时保存到云端和本地

#### 问题修复
修复 SQLite 数据库只读错误：
- 添加数据库权限检查和自动修复逻辑
- 实现数据库备份机制

---

## [2.9.7] - 2026-01-07

### ✨ 新功能 - AI 对话记忆

#### 功能描述
实现 AI 记忆系统，在每次回答问题前自动读取用户的历史记忆、偏好、常用操作等信息。

#### 技术实现
- 新增工具 `get_ai_memory` 和 `save_ai_memory`
- 记忆文件存储在 `~/xiaobai-ai-memory.md`
- 系统提示词添加"AI对话记忆管理"章节，强制要求每次对话前读取记忆

---

## [2.9.6] - 2026-01-07

### ✨ 新功能 - 系统命令直接执行

#### 功能描述
AI 可以直接执行简单的系统命令，如"打开微信"、"列出文件"等，无需详细解释。

#### 技术实现
在系统提示词中添加"系统命令执行规则"：
- **直接执行**: 简单、可逆的操作（如打开应用、查看信息）
- **先询问**: 危险、不可逆的操作（如删除、系统配置修改）
- **说明后执行**: 需要用户了解的操作（如安装软件）

---

## [2.9.4] - 2026-01-07

### 优化
- ✨ 优化强制更新弹窗样式（居中显示 + 深色遮罩）
- 🎨 改进更新弹窗的默认文案展示
- 📝 支持自定义更新说明

### 修复
- 🐛 修复"立即重启"按钮点击无效的问题
- 🔧 优化应用退出逻辑，确保更新重启正常

---

## [2.9.3] - 2026-01-07

### 新增
- ⭐ AI 思考过程显示功能
- 📤 支持阿里云 OSS 自动更新
- 🎭 添加等待动画（思考、查阅、搜索、联网）

### 优化
- 💾 修复 AI 回复的思考过程未保存到云端的问题
- 🔗 文件路径点击功能优化（支持内联代码格式）
- 🎨 UI 体验优化（气泡样式、等待动画）

---

## [2.9.2] - 2026-01-06

### 新增
- 🌐 云端登录系统（手机号 + 验证码）
- 💬 对话历史云端同步
- 👥 用户信息云端存储

### 优化
- 🚀 性能优化和稳定性提升

---

## [2.9.1] - 2026-01-05

### 新增
- 🎉 首次发布
- 🤖 集成 Claude Agent SDK
- 💻 基础对话功能
- 📁 文件操作能力
