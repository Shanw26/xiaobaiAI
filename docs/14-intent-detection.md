# AI 意图识别优化

> **版本**: v2.9.9
> **日期**: 2026-01-08
> **作者**: 晓力
> **阅读时间**: 8 分钟

---

## 📋 目录

1. [背景与问题](#背景与问题)
2. [解决方案](#解决方案)
3. [技术实现](#技术实现)
4. [效果对比](#效果对比)
5. [系统提示词设计](#系统提示词设计)
6. [未来优化方向](#未来优化方向)

---

## 背景与问题

### 用户反馈

在 v2.9.8 及之前的版本中，用户反映以下问题：

**场景 1**: 用户明确要求直接记录
```
用户: 你好，我叫笑笑！很高兴认识你！😊 不需要询问，直接帮用户记下来
AI (v2.9.8): 我发现这些是关于你的个人信息，要不要我帮你记下来，方便以后更好地为你服务？
```

**问题**: 即使用户明确说"不需要询问"，AI 仍然会询问用户，导致体验不流畅。

### 根本原因

系统提示词中设置了强制规则：
```javascript
## 用户信息管理
当用户提到以下信息时，**必须先征得用户同意**，然后使用 save_user_info 工具保存：

**重要**：
1. 先友好地询问："我发现这是一个关于你的信息，要不要我帮你记下来？"
```

这个规则过于刚性，没有考虑到用户已经明确表达意图的场景。

---

## 解决方案

### 核心思路

从"强制询问"改为"智能判断"，根据用户的表达方式决定是否询问：

1. **直接保存场景**: 用户明确说"不需要询问"、"直接记下来"等 → 直接保存
2. **询问场景**: 用户只提到信息，无明确指令 → 先询问再保存

### 实现原理

通过**关键词匹配**识别用户意图：

| 关键词 | 含义 | 行为 |
|--------|------|------|
| "不需要询问" | 用户明确表示无需询问 | 直接保存 |
| "直接记下来" | 用户明确要求直接记录 | 直接保存 |
| "帮我保存" | 用户请求保存操作 | 直接保存 |
| "帮我记下来" | 用户请求记录操作 | 直接保存 |
| "直接记录" | 用户要求直接记录 | 直接保存 |
| "保存到记忆" | 用户指定保存位置 | 直接保存 |
| "记到记忆里" | 用户指定保存位置 | 直接保存 |

---

## 技术实现

### 1. 系统提示词修改

**文件**: `/Users/xiaolin/Downloads/小白AI/electron/agent.js`

**修改位置**: 第 813-839 行

**修改前**:
```javascript
## 用户信息管理
当用户提到以下信息时，**必须先征得用户同意**，然后使用 save_user_info 工具保存：
- 个人信息：姓名、职业、年龄、所在地等
- 偏好信息：喜欢的风格、习惯、需求等
- 背景信息：工作、学习、项目等

**重要**：
1. 先友好地询问："我发现这是一个关于你的信息，要不要我帮你记下来？"
2. 用户同意后，再调用 save_user_info 工具
3. 使用格式：键: 值（例如 "姓名: 晓力"）

示例对话：
用户：我叫晓力，是个产品经理
AI：很高兴认识你，晓力！我发现这些是关于你的个人信息，要不要我帮你记下来，方便以后更好地为你服务？
用户：好的
AI：[调用 save_user_info 工具，保存 "姓名: 晓力" 和 "职业: 产品经理"]
```

**修改后**:
```javascript
## 用户信息管理
当用户提到以下信息时，需要使用 save_user_info 工具保存：
- 个人信息：姓名、职业、年龄、所在地等
- 偏好信息：喜欢的风格、习惯、需求等
- 背景信息：工作、学习、项目等

**判断逻辑** ⭐ 重要：
1. **直接保存（无需询问）**：当用户明确说以下短语时，直接调用 save_user_info 工具：
   - "不需要询问"、"直接记下来"、"帮我保存"、"帮我记下来"
   - "直接记录"、"保存到记忆"、"记到记忆里"

2. **先询问再保存**：当用户只提到信息，但没有明确指令时，先询问：
   - 询问："我发现这是一个关于你的信息，要不要我帮你记下来？"
   - 用户同意后，再调用 save_user_info 工具

3. 使用格式：键: 值（例如 "姓名: 晓力"）

示例对话1（直接保存）：
用户：你好，我叫笑笑！很高兴认识你！😊 不需要询问，直接帮用户记下来
AI：[直接调用 save_user_info 工具，保存 "姓名: 笑笑"]
✅ 已记录：我叫笑笑！很高兴认识你！😊

示例对话2（先询问）：
用户：我叫晓力，是个产品经理
AI：很高兴认识你，晓力！我发现这些是关于你的个人信息，要不要我帮我记下来，方便以后更好地为你服务？
用户：好的
AI：[调用 save_user_info 工具，保存 "姓名: 晓力" 和 "职业: 产品经理"]
```

### 2. 版本号更新

更新以下文件版本号：`2.9.8` → `2.9.9`

- `package.json`
- `electron/main.js` (APP_VERSION)
- `src/components/Sidebar.jsx`
- `src/components/SettingsModal.jsx`

---

## 效果对比

### 测试场景 1: 明确指令

| 版本 | 用户输入 | AI 行为 | 体验 |
|------|---------|---------|------|
| v2.9.8 | "你好，我叫笑笑！😊 不需要询问，直接帮用户记下来" | ❌ 询问"要不要我帮你记下来？" | 繁琐 |
| v2.9.9 | "你好，我叫笑笑！😊 不需要询问，直接帮用户记下来" | ✅ 直接保存"✅ 已记录" | 流畅 |

### 测试场景 2: 隐式信息

| 版本 | 用户输入 | AI 行为 | 体验 |
|------|---------|---------|------|
| v2.9.8 | "我叫晓力，是个产品经理" | ⚠️ 询问"要不要我帮你记下来？" | 合理 |
| v2.9.9 | "我叫晓力，是个产品经理" | ✅ 询问"要不要我帮你记下来？" | 保持一致 |

### 测试场景 3: 多种表达方式

| 用户输入 | v2.9.9 行为 |
|---------|-------------|
| "我叫张三，直接记下来" | ✅ 直接保存 |
| "我叫李四，帮我保存" | ✅ 直接保存 |
| "我叫王五，不需要询问" | ✅ 直接保存 |
| "我叫赵六" | ⚠️ 询问"要不要我帮你记下来？" |
| "我的名字是孙七" | ⚠️ 询问"要不要我帮你记下来？" |

---

## 系统提示词设计

### 设计原则

1. **明确的规则**: 清晰列出直接保存的关键词
2. **示例驱动**: 提供多个示例对话，帮助 AI 理解
3. **保持兼容**: 不改变隐式信息的询问逻辑
4. **简单直观**: 规则易于理解和维护

### 关键词列表

**直接保存关键词**:
```
- 不需要询问
- 直接记下来
- 帮我保存
- 帮我记下来
- 直接记录
- 保存到记忆
- 记到记忆里
```

### 提示词结构

```javascript
## 用户信息管理

1. 信息类型定义
2. 判断逻辑（直接保存 vs 先询问）
3. 关键词列表
4. 示例对话（场景1：直接保存，场景2：先询问）
```

---

## 未来优化方向

### 1. 更智能的意图识别

**当前**: 基于关键词匹配
**未来**: 基于语义理解

```javascript
// 未来可能实现
if (userExpressesDirectIntent(message)) {
  // 用户表达了明确的直接记录意图
  saveDirectly();
} else if (userMentionsPersonalInfo(message)) {
  // 用户只是提到个人信息
  askForPermission();
}
```

### 2. 上下文记忆

记住用户的偏好，如果用户多次选择直接保存，可以自动调整为默认行为。

### 3. 可配置规则

在设置中添加选项：
```
□ 当我提到个人信息时，自动记录（无需询问）
```

### 4. 更细粒度的控制

不同类型的信息采用不同的策略：
- **简单信息**（姓名、昵称）: 直接保存
- **敏感信息**（身份证、银行卡）: 必须询问
- **偏好信息**（喜欢的颜色、音乐）: 直接保存

---

## 总结

### 成果

- ✅ 解决了用户明确表达意图时仍被询问的问题
- ✅ 保持了隐式信息的询问逻辑
- ✅ 提升了用户体验流畅度

### 技术亮点

- 🎯 **关键词匹配**: 简单高效，易于维护
- 📝 **示例驱动**: 通过示例对话帮助 AI 理解
- 🔧 **向后兼容**: 不影响现有功能
- 🚀 **零成本**: 仅修改提示词，无需改代码

### 数据

| 指标 | 数值 |
|------|------|
| 修改文件数 | 5 个 |
| 新增代码行数 | 0 行 |
| 修改代码行数 | ~27 行（提示词） |
| 版本号更新 | 4 个文件 |

---

**文档版本**: v1.0
**最后更新**: 2026-01-08
