# 应用用户信息和AI记忆表迁移

## 问题
用户信息和AI记忆保存失败，因为 Supabase 云端数据库中缺少这两个表。

## 解决方案

### 方法1：通过 Supabase Dashboard（推荐）

1. 打开 Supabase Dashboard：https://cnszooaxwxatezodbbxq.supabase.co
2. 点击左侧菜单 **SQL Editor**
3. 点击 **New Query**
4. 粘贴以下 SQL 代码并执行：

```sql
-- 添加用户信息表
CREATE TABLE IF NOT EXISTS user_info (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID,
  device_id VARCHAR(64),
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  UNIQUE (user_id, device_id)
);

-- 添加 AI 记忆表
CREATE TABLE IF NOT EXISTS ai_memory (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID,
  device_id VARCHAR(64),
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  UNIQUE (user_id, device_id)
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_user_info_user ON user_info(user_id);
CREATE INDEX IF NOT EXISTS idx_user_info_device ON user_info(device_id);
CREATE INDEX IF NOT EXISTS idx_ai_memory_user ON ai_memory(user_id);
CREATE INDEX IF NOT EXISTS idx_ai_memory_device ON ai_memory(device_id);
```

5. 点击 **Run** 按钮执行

### 方法2：通过 Supabase CLI（需要安装）

```bash
# 安装 Supabase CLI（如果未安装）
brew install supabase/tap/supabase

# 链接到项目
supabase link --project-ref cnszooaxwxatezodbbxq

# 应用迁移
supabase db push
```

## 验证

执行完成后，在 Supabase Dashboard 的 **Table Editor** 中应该能看到：
- `user_info` 表
- `ai_memory` 表

## 完成

迁移应用后，刷新应用，再次尝试保存用户信息和AI记忆即可。
