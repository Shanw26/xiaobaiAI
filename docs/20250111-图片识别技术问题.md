# å›¾ç‰‡è¯†åˆ«æŠ€æœ¯é—®é¢˜è®°å½•

**æ—¥æœŸ**: 2025å¹´1æœˆ11æ—¥
**ç‰ˆæœ¬**: v2.20.5
**çŠ¶æ€**: å¾…è§£å†³

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·ç²˜è´´æˆªå›¾ï¼ˆCmd+Vï¼‰åï¼ŒAIæ— æ³•è¯†åˆ«å›¾ç‰‡å†…å®¹ã€‚

### å½“å‰çŠ¶æ€
- âœ… **æ–‡å­—è¾“å…¥**ï¼šæ­£å¸¸å·¥ä½œ
- âœ… **ä¸Šä¼ æ–‡ä»¶**ï¼šæ­£å¸¸å·¥ä½œï¼Œæ”¯æŒå›¾ç‰‡ã€PDFã€ä»£ç æ–‡ä»¶è§£æ
- âœ… **æˆªå›¾æŒ‰é’®**ï¼šå¯ä»¥æˆªå›¾å¹¶ä¸Šä¼ 
- âŒ **ç²˜è´´æˆªå›¾**ï¼šå‘é€å¤±è´¥æˆ–AIæ— æ³•è¯†åˆ«

## ğŸ” æ ¹æœ¬åŸå› 

**æ™ºè°±AIçš„Anthropicå…¼å®¹APIä¸æ”¯æŒå›¾ç‰‡æ ¼å¼**

```javascript
// âŒ æ™ºè°±çš„Anthropicå…¼å®¹API (https://open.bigmodel.cn/api/anthropic)
// ä¸æ”¯æŒè¿™ç§æ ¼å¼ï¼š
{
  type: 'image',
  source: {
    type: 'base64',
    media_type: 'image/png',
    data: 'iVBORw0KGgo...'
  }
}

// âœ… æ™ºè°±åŸç”ŸAPIéœ€è¦çš„æ ¼å¼ï¼š
{
  type: 'image_url',
  image_url: {
    url: 'base64å­—ç¬¦ä¸²' // ä¸éœ€è¦data:imageå‰ç¼€
  }
}
```

### æŠ€æœ¯ç»†èŠ‚

1. **ä»£ç ä½ç½®**: `electron/agent.js` çš„ `sendMessage` å‡½æ•°
2. **å½“å‰å®ç°**: ä½¿ç”¨Anthropic SDKè°ƒç”¨æ™ºè°±çš„Anthropicå…¼å®¹API
3. **å›¾ç‰‡æ•°æ®æµ**:
   - å‰ç«¯: `InputArea.jsx` â†’ `handlePaste` æ•è·å‰ªè´´æ¿å›¾ç‰‡
   - æ•°æ®: blob â†’ base64 â†’ å‘é€åˆ°mainè¿›ç¨‹
   - åç«¯: `main.js` â†’ `agent.js` â†’ æ„å»ºAnthropicæ ¼å¼å›¾ç‰‡æ¶ˆæ¯
   - é—®é¢˜: æ™ºè°±APIæ— æ³•è¯†åˆ«Anthropicå›¾ç‰‡æ ¼å¼

## ğŸ› ï¸ å·²å°è¯•çš„æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä½¿ç”¨æ™ºè°±åŸç”ŸHTTP API
**çŠ¶æ€**: âŒ å¤±è´¥ - 400é”™è¯¯

```javascript
// å°è¯•ç›´æ¥è°ƒç”¨æ™ºè°±åŸç”ŸAPI
await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    model: 'glm-4v-flash',
    messages: [{
      role: 'user',
      content: [{
        type: 'image_url',
        image_url: { url: base64String }
      }]
    }]
  })
})
```

**é”™è¯¯**: `{"error":{"code":"1210","message":"API è°ƒç”¨å‚æ•°æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡æ¡£ã€‚"}}`

### æ–¹æ¡ˆ2: ä½¿ç”¨æ™ºè°±å®˜æ–¹SDK
**çŠ¶æ€**: âŒ å¤±è´¥ - APIè°ƒç”¨é”™è¯¯

```bash
npm install zhipuai-sdk-nodejs-v4
```

```javascript
import { ZhipuAI } from 'zhipuai-sdk-nodejs-v4';
const ai = new ZhipuAI({ apiKey });
await ai.createCompletions({
  model: 'glm-4v-flash',
  messages: zhipuMessages
})
```

**é”™è¯¯**: `TypeError: Cannot read properties of undefined (reading 'completions')`

### æ–¹æ¡ˆ3: ä¿®å¤base64æ ¼å¼
**çŠ¶æ€**: âŒ æ— æ•ˆ

- å°è¯•ç§»é™¤ `data:image/png;base64,` å‰ç¼€ï¼Œä½¿ç”¨çº¯base64
- å°è¯•ä¸åŒçš„æ¨¡å‹åç§°ï¼š`glm-4v`, `glm-4v-flash`, `glm-4v-plus`
- ç»“æœï¼šä»ç„¶400é”™è¯¯

## ğŸ’¡ å¾…è§£å†³çš„æ–¹æ¡ˆ

### æ–¹æ¡ˆA: åˆ‡æ¢åˆ°Claude APIï¼ˆæ¨èï¼‰
**ä¼˜ç‚¹**:
- Claude APIå®Œç¾æ”¯æŒå›¾ç‰‡è¯†åˆ«
- ä»£ç å·²ä½¿ç”¨Anthropic SDKï¼Œåˆ‡æ¢ç®€å•
- å›¾ç‰‡è¯†åˆ«å‡†ç¡®ç‡é«˜

**ç¼ºç‚¹**:
- éœ€è¦Claude API Key
- APIæˆæœ¬ä¸åŒ

**å®ç°æ­¥éª¤**:
1. ç”¨æˆ·é…ç½®Claude API Key
2. åœ¨è®¾ç½®ä¸­é€‰æ‹©providerä¸º`anthropic`
3. ç²˜è´´æˆªå›¾ç«‹å³å¯ç”¨

### æ–¹æ¡ˆB: ç»§ç»­ç ”ç©¶æ™ºè°±åŸç”ŸAPI
**éœ€è¦**:
1. ä»”ç»†ç ”ç©¶æ™ºè°±å®˜æ–¹æ–‡æ¡£
2. æ‰¾åˆ°æ­£ç¡®çš„APIè°ƒç”¨æ–¹å¼
3. æµ‹è¯•ä¸åŒçš„å‚æ•°ç»„åˆ

**å‚è€ƒæ–‡æ¡£**:
- [æ™ºè°±AIå¼€æ”¾æ–‡æ¡£](https://docs.bigmodel.cn/)
- [GLM-4V-Plusæ–‡æ¡£](https://docs.bigmodel.cn/cn/guide/models/vlm/glm-4v-plus-0111)
- [zhipuai-sdk-nodejs-v4](https://www.npmjs.com/package/zhipuai-sdk-nodejs-v4)

### æ–¹æ¡ˆC: ä¸´æ—¶æ–¹æ¡ˆ
**å½“å‰å¯ç”¨**:
1. âœ… ä½¿ç”¨æˆªå›¾æŒ‰é’® â†’ æˆªå›¾ä¿å­˜ä¸ºæ–‡ä»¶ â†’ ä¸Šä¼ æ–‡ä»¶
2. âœ… å…ˆç”¨ç³»ç»Ÿæˆªå›¾å·¥å…·ï¼ˆCmd+Shift+4ï¼‰ â†’ ä¸Šä¼ æ–‡ä»¶
3. âœ… ç²˜è´´æˆªå›¾åæ‰‹åŠ¨æ·»åŠ æ–‡å­—æè¿°

## ğŸ“ å…³é”®ä»£ç ä½ç½®

### å‰ç«¯
- **ç²˜è´´å¤„ç†**: `src/components/InputArea.jsx:handlePaste` (line 153-193)
- **æˆªå›¾æŒ‰é’®**: `src/components/InputArea.jsx:handleScreenshot` (line 113-139)
- **æ–‡ä»¶ä¸Šä¼ **: `src/components/InputArea.jsx:handleFileSelect` (line 102-111)

### åç«¯
- **æ–‡ä»¶å¤„ç†**: `electron/main.js:1397-1428` (fileInfoså¤„ç†)
- **å›¾ç‰‡å‘é€**: `electron/agent.js:915-951` (sendMessageä¸­çš„å›¾ç‰‡å¤„ç†)
- **OCRè¯†åˆ«**: `electron/fileParser.js` (parseImageå‡½æ•°)

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•1: ç²˜è´´çº¯æ–‡æœ¬æˆªå›¾
```
æ­¥éª¤: æˆªå›¾åŒ…å«æ–‡å­— â†’ Cmd+Vç²˜è´´ â†’ å‘é€
é¢„æœŸ: AIè¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—
å®é™…: AIçœ‹ä¸åˆ°å›¾ç‰‡å†…å®¹
```

### æµ‹è¯•2: ç²˜è´´å‘ç¥¨æˆªå›¾
```
æ­¥éª¤: æˆªå›¾å‘ç¥¨ â†’ Cmd+Vç²˜è´´ â†’ å‘é€
é¢„æœŸ: AIè¯†åˆ«å‘ç¥¨ä¿¡æ¯
å®é™…: AIçœ‹ä¸åˆ°å›¾ç‰‡å†…å®¹
```

### æµ‹è¯•3: ä¸Šä¼ æˆªå›¾æ–‡ä»¶
```
æ­¥éª¤: æˆªå›¾ä¿å­˜ä¸ºæ–‡ä»¶ â†’ ç‚¹å‡»ä¸Šä¼ æŒ‰é’® â†’ é€‰æ‹©æ–‡ä»¶ â†’ å‘é€
é¢„æœŸ: AIè¯†åˆ«å›¾ç‰‡å†…å®¹
å®é™…: âœ… æ­£å¸¸å·¥ä½œ
```

## ğŸ”— ç›¸å…³èµ„æº

- [æ™ºè°±AIå¹³å°](https://open.bigmodel.cn/)
- [Claude APIæ–‡æ¡£](https://docs.anthropic.com/)
- [Anthropic SDK](https://www.npmjs.com/package/@anthropic-ai/sdk)

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ11æ—¥
**è´Ÿè´£äºº**: Claude Code
**ä¼˜å…ˆçº§**: ä¸­ï¼ˆå¯å…ˆä½¿ç”¨ä¸Šä¼ æ–‡ä»¶æ–¹å¼ï¼‰
