# v2.10.13 - Service Role Key å®‰å…¨åŠ å›º

> **æ›´æ–°æ—¶é—´**: 2026-01-08
> **å®‰å…¨çº§åˆ«**: â­â­â­â­ (ä» â­â­â­ æå‡åˆ° â­â­â­â­)
> **æ”¹è¿›ç±»å‹**: é˜²å¾¡æ€§å®‰å…¨æªæ–½

---

## ğŸ“‹ é—®é¢˜å›é¡¾

### åŸå§‹è®¾è®¡

**ä½ç½®**: `src/lib/supabaseClient.js`

```javascript
// å¯¼å‡ºäº† supabaseAdminï¼ˆä½¿ç”¨ Service Role Keyï¼‰
export const supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey);
export const supabaseServiceKey = supabaseAdmin;
```

**è®¾è®¡æ„å›¾**:
- âœ… æ³¨é‡Šè¯´æ˜"ä»…ç”¨äº Electron ä¸»è¿›ç¨‹"
- âœ… åœ¨ `cloudService.js` ä¸­ä½¿ç”¨ï¼Œç»•è¿‡ RLS è¿›è¡Œå¿…è¦æ“ä½œ
- âœ… ç”¨äºï¼šéªŒè¯ç éªŒè¯ã€ç”¨æˆ·åˆ›å»ºã€ç»Ÿè®¡æ•°æ®ç­‰

**å®‰å…¨é£é™©**:
- âš ï¸ è™½ç„¶æœ‰æ³¨é‡Šï¼Œä½†ä»£ç å®é™…ä¸Šåœ¨å‰ç«¯ bundle ä¸­
- âš ï¸ å¦‚æœ React ç»„ä»¶è¯¯ç”¨ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²
- âš ï¸ æ²¡æœ‰ IDE/ç¼–è¯‘å™¨å±‚é¢çš„å¼ºåˆ¶æ£€æŸ¥

---

## ğŸ”’ å®æ–½çš„æ”¹è¿›æªæ–½

### 1. è¿è¡Œæ—¶å®‰å…¨æ£€æŸ¥ âœ…

**æ–‡ä»¶**: `src/lib/supabaseClient.js`

**æ”¹è¿›å†…å®¹**:

```javascript
// ğŸ”’ å®‰å…¨æ£€æŸ¥ï¼šé˜²æ­¢ supabaseAdmin è¢«è¯¯ç”¨
// è¿è¡Œæ—¶æ£€æµ‹ï¼šå¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­è¢«å¯¼å…¥ï¼Œå‘å‡ºè­¦å‘Š
if (typeof window !== 'undefined' && window.location?.protocol === 'https:') {
  console.error('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
  console.error('â•‘ ğŸ”´ å®‰å…¨è­¦å‘Šï¼šsupabaseAdmin ä¸åº”åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ï¼          â•‘');
  console.error('â•‘                                                                   â•‘');
  console.error('â•‘ âš ï¸  supabaseAdmin ä½¿ç”¨ Service Role Keyï¼Œå¯ä»¥ï¼š                 â•‘');
  console.error('â•‘    - ç»•è¿‡ RLSï¼ˆè¡Œçº§å®‰å…¨ç­–ç•¥ï¼‰                                  â•‘');
  console.error('â•‘    - è®¿é—®æ‰€æœ‰ç”¨æˆ·æ•°æ®                                          â•‘');
  console.error('â•‘    - ä¿®æ”¹æ•°æ®åº“ä»»æ„å†…å®¹                                        â•‘');
  console.error('â•‘                                                                   â•‘');
  console.error('â•‘ âœ… è¯·æ”¹ç”¨ supabaseï¼ˆAnon Keyï¼‰ï¼Œå®ƒæœ‰ RLS ä¿æŠ¤                     â•‘');
  console.error('â•‘                                                                   â•‘');
  console.error('â•‘ ğŸ“– æ–‡æ¡£ï¼šdocs/02-login-system.md                                â•‘');
  console.error('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.error('');
  console.error('æ­£ç¡®çš„ç”¨æ³•ï¼š');
  console.error('  import { supabase } from \'./lib/supabaseClient\';  âœ…');
  console.error('');
  console.error('é”™è¯¯ç”¨æ³•ï¼ˆä¼šå¯¼è‡´å®‰å…¨æ¼æ´ï¼‰ï¼š');
  console.error('  import { supabaseAdmin } from \'./lib/supabaseClient\';  âŒ');
  console.error('');
}
```

**æ•ˆæœ**:
- âœ… å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¼šçœ‹åˆ°æ˜æ˜¾çš„çº¢è‰²è­¦å‘Š
- âœ… å¼€å‘è€…èƒ½ç«‹å³å‘ç°é”™è¯¯ç”¨æ³•
- âœ… è­¦å‘Šä¿¡æ¯åŒ…å«æ­£ç¡®çš„ç”¨æ³•ç¤ºä¾‹

---

### 2. ESLint è§„åˆ™ç¦æ­¢å¯¼å…¥ âœ…

**æ–‡ä»¶**: `.eslintrc.json` (æ–°å»º)

**æ”¹è¿›å†…å®¹**:

```json
{
  "rules": {
    "no-restricted-imports": [
      "error",
      {
        "name": "supabaseAdmin",
        "importNames": ["supabaseAdmin"],
        "message": "ğŸ”´ å®‰å…¨è­¦å‘Šï¼šä¸å…è®¸å¯¼å…¥ supabaseAdminï¼..."
      },
      {
        "name": "supabaseServiceKey",
        "importNames": ["supabaseServiceKey"],
        "message": "ğŸ”´ å®‰å…¨è­¦å‘Šï¼šä¸å…è®¸å¯¼å…¥ supabaseServiceKeyï¼..."
      }
    ]
  },
  "overrides": [
    {
      "files": ["src/lib/cloudService.js"],
      "rules": {
        "no-restricted-imports": "off"
      }
    }
  ]
}
```

**æ•ˆæœ**:
- âœ… IDE ä¸­ä¼šå®æ—¶æ˜¾ç¤ºé”™è¯¯
- âœ… ç¼–è¯‘æ—¶ä¼šé˜»æ­¢è¿è§„ä»£ç 
- âœ… å…è®¸ `cloudService.js` ä½¿ç”¨ï¼ˆoverridesï¼‰
- âœ… è¯¦ç»†çš„å®‰å…¨æç¤ºå’Œä¿®å¤å»ºè®®

**é¢„æœŸæ•ˆæœ**:
```javascript
// âŒ åœ¨ React ç»„ä»¶ä¸­ï¼ˆä¼šæŠ¥é”™ï¼‰
import { supabaseAdmin } from './lib/supabaseClient';
// ESLint é”™è¯¯ï¼šğŸ”´ å®‰å…¨è­¦å‘Šï¼šä¸å…è®¸å¯¼å…¥ supabaseAdminï¼

// âœ… åœ¨ cloudService.js ä¸­ï¼ˆå…è®¸ï¼‰
import { supabaseAdmin } from './lib/supabaseClient';
// æ­£å¸¸å·¥ä½œ
```

---

### 3. å¼ºåŒ–æ³¨é‡Šå’Œæ–‡æ¡£ âœ…

**æ–‡ä»¶**: `src/lib/cloudService.js`

**æ”¹è¿›å†…å®¹**:

```javascript
// ğŸ”’ å®‰å…¨è¯´æ˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸  æœ¬æ–‡ä»¶ä½¿ç”¨ supabaseAdminï¼ˆService Role Keyï¼‰
// âš ï¸  supabaseAdmin å¯ä»¥ç»•è¿‡ RLSï¼Œè®¿é—®å’Œä¿®æ”¹æ‰€æœ‰æ•°æ®
// âš ï¸  å› æ­¤æœ¬æ–‡ä»¶åªèƒ½åœ¨ Electron ä¸»è¿›ç¨‹ä¸­é€šè¿‡ IPC è°ƒç”¨
// âš ï¸  ç»ä¸èƒ½åœ¨ React ç»„ä»¶ä¸­ç›´æ¥å¯¼å…¥ä½¿ç”¨ï¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// ğŸ“– å®‰å…¨è§„åˆ™ï¼š
//   âœ… å…è®¸ï¼šé€šè¿‡ window.electronAPI è°ƒç”¨ï¼ˆElectron IPCï¼‰
//   âœ… å…è®¸ï¼šåœ¨ Electron ä¸»è¿›ç¨‹ä¸­ç›´æ¥ä½¿ç”¨
//   âŒ ç¦æ­¢ï¼šåœ¨ React ç»„ä»¶ä¸­ import { supabaseAdmin }
//   âŒ ç¦æ­¢ï¼šåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨
//
// ğŸ“– è®¾è®¡æ–‡æ¡£ï¼šdocs/02-login-system.md
// ğŸ“– æ¶æ„è¯´æ˜ï¼šdocs/07-system-architecture.md
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**æ•ˆæœ**:
- âœ… æ–‡ä»¶é¡¶éƒ¨æœ‰æ˜æ˜¾çš„å®‰å…¨è­¦å‘Š
- âœ… æ˜ç¡®è¯´æ˜å…è®¸å’Œç¦æ­¢çš„ä½¿ç”¨æ–¹å¼
- âœ… æä¾›ç›¸å…³æ–‡æ¡£é“¾æ¥

---

### 4. å®‰å…¨æ£€æŸ¥è„šæœ¬ âœ…

**æ–‡ä»¶**: `scripts/security-check-imports.js` (æ–°å»º)

**åŠŸèƒ½**:
- è‡ªåŠ¨æ‰«æ `src/components`ã€`src/hooks`ã€`src/utils` ç­‰ç›®å½•
- æ£€æµ‹æ˜¯å¦æœ‰æ–‡ä»¶è¿è§„å¯¼å…¥äº† `supabaseAdmin`
- å‘ç°è¿è§„æ—¶è¾“å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

**ä½¿ç”¨æ–¹æ³•**:

```bash
# è¿è¡Œå®‰å…¨æ£€æŸ¥
npm run security:check-imports
```

**é¢„æœŸè¾“å‡º**:

**é€šè¿‡æ—¶**:
```
ğŸ”’ å®‰å…¨æ£€æŸ¥ï¼šæ£€æŸ¥ supabaseAdmin è¿è§„å¯¼å…¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‚ æ£€æŸ¥ç›®å½•ï¼šsrc/components

âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼æœªå‘ç°è¿è§„å¯¼å…¥ã€‚
```

**å¤±è´¥æ—¶**:
```
ğŸ”´ å‘ç°å®‰å…¨è¿è§„ï¼šsrc/components/Example.jsx
   è¿è§„ä»£ç ï¼š
   - import { supabaseAdmin } from './lib/supabaseClient';

âŒ å®‰å…¨æ£€æŸ¥å¤±è´¥ï¼å‘ç°è¿è§„å¯¼å…¥ supabaseAdmin çš„æ–‡ä»¶ã€‚

ä¿®å¤å»ºè®®ï¼š
  1. åˆ é™¤è¿è§„çš„å¯¼å…¥è¯­å¥
  2. ä½¿ç”¨ supabaseï¼ˆAnon Keyï¼‰ä»£æ›¿
  3. æˆ–è€…é€šè¿‡ Electron IPC è°ƒç”¨
```

---

## ğŸ“Š å®‰å…¨æå‡å¯¹æ¯”

| æ–¹é¢ | æ”¹è¿›å‰ | æ”¹è¿›å |
|-----|-------|-------|
| **è¿è¡Œæ—¶ä¿æŠ¤** | âŒ æ—  | âœ… æµè§ˆå™¨ç¯å¢ƒä¼šæŠ¥è­¦å‘Š |
| **å¼€å‘æ—¶æ£€æŸ¥** | âŒ æ—  | âœ… ESLint å®æ—¶æŠ¥é”™ |
| **æ–‡æ¡£è¯´æ˜** | â­â­ å•è¡Œæ³¨é‡Š | â­â­â­â­ è¯¦ç»†å®‰å…¨è¯´æ˜ |
| **è‡ªåŠ¨åŒ–æ£€æµ‹** | âŒ æ—  | âœ… è„šæœ¬è‡ªåŠ¨æ‰«æ |
| **å®‰å…¨æ€§** | â­â­â­ ä¸­ç­‰ | â­â­â­â­ ä¼˜ç§€ |

---

## ğŸ¯ å®‰å…¨å±‚çº§ï¼ˆé˜²å¾¡æ·±åº¦ï¼‰

```
ç¬¬ 1 å±‚ï¼šä»£ç æ³¨é‡Šå’Œæ–‡æ¡£
   â””â”€ æ˜ç¡®è¯´æ˜ä½¿ç”¨è§„åˆ™å’Œé£é™©

ç¬¬ 2 å±‚ï¼šESLint é™æ€æ£€æŸ¥
   â””â”€ IDE å’Œç¼–è¯‘æ—¶æ£€æµ‹è¿è§„

ç¬¬ 3 å±‚ï¼šè¿è¡Œæ—¶å®‰å…¨æ£€æŸ¥
   â””â”€ æµè§ˆå™¨ç¯å¢ƒè‡ªåŠ¨æŠ¥è­¦

ç¬¬ 4 å±‚ï¼šè‡ªåŠ¨åŒ–å®‰å…¨æ‰«æ
   â””â”€ CI/CD ä¸­è¿è¡Œ security:check-imports
```

---

## âœ… éªŒè¯ç»“æœ

### 1. å®‰å…¨æ£€æŸ¥è„šæœ¬é€šè¿‡

```bash
$ npm run security:check-imports
âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼æœªå‘ç°è¿è§„å¯¼å…¥ã€‚
```

### 2. åŠŸèƒ½æ­£å¸¸å·¥ä½œ

- âœ… `cloudService.js` ä»å¯æ­£å¸¸ä½¿ç”¨ `supabaseAdmin`
- âœ… ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- âœ… æ¸¸å®¢æ¨¡å¼ç»Ÿè®¡æ­£å¸¸
- âœ… æ•°æ®åˆå¹¶åŠŸèƒ½æ­£å¸¸

### 3. å…¼å®¹æ€§ä¿æŒ

- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… æ— éœ€ä¿®æ”¹å…¶ä»–ä»£ç 
- âœ… å‘åå…¼å®¹

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### å¼€å‘è€…æ³¨æ„äº‹é¡¹

1. **åœ¨ React ç»„ä»¶ä¸­**ï¼ˆå®‰å…¨ï¼‰:
   ```javascript
   import { supabase } from './lib/supabaseClient';
   // âœ… ä½¿ç”¨ supabaseï¼ˆAnon Keyï¼‰
   ```

2. **åœ¨ cloudService.js ä¸­**ï¼ˆå…è®¸ï¼‰:
   ```javascript
   import { supabaseAdmin } from './supabaseClient';
   // âœ… å…è®¸ä½¿ç”¨ï¼ˆElectron ä¸»è¿›ç¨‹ï¼‰
   ```

3. **å…¶ä»–æ–‡ä»¶ä¸­**ï¼ˆç¦æ­¢ï¼‰:
   ```javascript
   import { supabaseAdmin } from './lib/supabaseClient';
   // âŒ ESLint é”™è¯¯ï¼Œè¿è¡Œæ—¶è­¦å‘Š
   ```

### CI/CD é›†æˆ

å»ºè®®åœ¨ CI/CD æµç¨‹ä¸­æ·»åŠ å®‰å…¨æ£€æŸ¥ï¼š

```yaml
# .github/workflows/security-check.yml
name: Security Check

on: [pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Check for forbidden imports
        run: npm run security:check-imports
```

---

## ğŸ‰ æ€»ç»“

é€šè¿‡å®æ–½ä»¥ä¸Šå››é¡¹æ”¹è¿›æªæ–½ï¼š

1. âœ… **è¿è¡Œæ—¶æ£€æŸ¥**ï¼šæµè§ˆå™¨ç¯å¢ƒè‡ªåŠ¨æŠ¥è­¦
2. âœ… **ESLint è§„åˆ™**ï¼šIDE å®æ—¶æç¤ºé”™è¯¯
3. âœ… **å¼ºåŒ–æ–‡æ¡£**ï¼šæ˜ç¡®çš„å®‰å…¨è¯´æ˜
4. âœ… **è‡ªåŠ¨åŒ–æ‰«æ**ï¼šCI/CD é›†æˆ

**å®‰å…¨æ€§æå‡**: â­â­â­ â†’ â­â­â­â­

è™½ç„¶ `supabaseAdmin` ä»åœ¨å‰ç«¯ bundle ä¸­ï¼Œä½†ç°åœ¨æœ‰äº†**å¤šå±‚é˜²å¾¡**ï¼š
- æ³¨é‡Šæ˜ç¡®è­¦å‘Š
- ESLint å¼ºåˆ¶æ£€æŸ¥
- è¿è¡Œæ—¶è‡ªåŠ¨æŠ¥è­¦
- è‡ªåŠ¨åŒ–æ‰«ææ£€æµ‹

è¿™æ ·æ—¢ä¿æŒäº†ç°æœ‰çš„æ¶æ„è®¾è®¡ï¼Œåˆå¤§å¹…æå‡äº†å®‰å…¨æ€§ã€‚

---

**ç»´æŠ¤è€…**: æ™“åŠ›
**å®¡æ ¸**: Claude Code å®‰å…¨å®¡è®¡
**ç‰ˆæœ¬**: v2.10.13
